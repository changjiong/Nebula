# Talos（Nebula 星图）任务推进规划（项目管理版）

> **更新**: 2026-01-27  
> **依据**: `docs/implementation_plan.md`（Phase 15/17 与差异项 0.2/9.3）  
> **目标**: 将“设计/实施计划”落地为可执行的任务拆解、里程碑、依赖、验收与节奏。

---

## 1. 项目目标与成功标准

### 1.1 总目标

在现有代码基线之上，完成 “对话执行闭环 → 能力资产化（Tool/Skill/Agent）→ 数据口径与血缘 → 产出物工作台 → 业务包落地 → 生产化” 的持续交付。

### 1.2 成功标准（可验收）

- **可用性**：`/api/v1/chat/stream` 在主流程下稳定流式输出（无死循环、无无响应），错误可定位。
- **正确性**：权限过滤口径与数据模型一致（`public/department/role`），不会误拒/误放行。
- **可管理**：`/tools`、`/skills`、`/agents` 至少实现“创建/编辑/测试/发布”的最小闭环（MVP）。
- **可解释**：工具输出与标准字段可映射，血缘图可从工具详情直达。
- **可沉淀**：至少交付一套可复用业务包（若干 Tool/Skill/Agent），并可导出产出物。

---

## 2. 项目组织与推进节奏（建议）

### 2.1 角色（最小配置）

| 角色 | 主要职责 |
|---|---|
| 产品负责人（PM） | 需求优先级、验收口径、跨团队协调、风险管理 |
| 架构/技术负责人（TL） | 技术方案决策、边界与依赖收敛、质量门禁 |
| 后端（BE） | API/模型/权限/编排/工具执行与稳定性 |
| 前端（FE） | 管理台、可视化编排、SSE 渲染、Canvas/组件 |
| 数据/算法（DS） | 业务工具与技能算法、口径定义、评估与验证 |
| QA/联调（QA） | 回归、接口契约、用例、联调推进 |

### 2.2 工作方式（两周一迭代）

- **迭代周期**：2 周一个 Sprint（可按团队实际调整）
- **仪式**：Sprint 计划会（0.5d）/ 站会（15m）/ 中期检查（0.5h）/ 评审验收（0.5d）/ 复盘（0.5h）
- **质量门禁**：每个 Sprint 至少交付 1 个“可演示+可验收”的端到端增量（避免只做底层）

---

## 3. 统一里程碑（消除 Phase/阶段口径冲突）

说明：`docs/implementation_plan.md` 中同时存在 Phase（15）与 阶段一～四（17）。本推进计划统一用“里程碑 M0–M6”管理交付物与验收口径。

| 里程碑 | 目标 | 关键交付物（可验收） |
|---|---|---|
| **M0 基线** | 现状可运行 | 前后端可启动；SSE 流式可用；核心 API 可访问 |
| **M1 核心稳定（P0）** | 修复阻塞技术债 | 权限口径统一；Provider/Adapter 对齐与兜底；Engine 入口收敛；关键数据获取工具可用 |
| **M2 知识工程 MVP** | Tool/Skill/Agent 管理闭环 | `/tools`、`/skills` 真对接；Skill 编排落库；在线测试与发布最小闭环 |
| **M3 数据标准 MVP** | 口径与血缘闭环 | TableField/Mapping 全流程；工具详情直达血缘图；基础校验与提示 |
| **M4 产出物 MVP** | 结果可沉淀 | artifact 事件标准化；Canvas 编辑/保存/导出最小闭环 |
| **M5 业务包 1.0** | 可复用业务落地 | 3–5 Tool + 2–3 Skill + 2 Agent 在真实场景可跑通与演示 |
| **M6 生产化** | 可观测、可扩展 | 指标/日志/审计/限流；共享记忆/缓存（Redis）；性能与稳定性改进 |

---

## 4. 工作流拆解（Workstreams）

| 工作流 | 说明 | 覆盖内容 |
|---|---|---|
| WS1 核心编排与流式 | 对话执行闭环与稳定性 | Planner/Executor/Memory/SSE、Engine 收敛 |
| WS2 权限与合规 | 口径一致与全链路过滤 | `public/department/role`、API 过滤、前端展示一致 |
| WS3 多模型与 Provider | 可配置、可用、可兜底 | Provider presets/Adapter 对齐、fallback 策略、可用性检测 |
| WS4 知识工程管理台 | 工具/技能/代理资产化 | `/tools`、`/skills`、`/agents` 管理闭环、测试与发布 |
| WS5 数据标准与血缘 | 口径统一与可解释 | 标准表/字段、映射、血缘图、质量提示 |
| WS6 Canvas 与可视化 | 产出物与组件体系 | artifact 事件、Canvas 编辑、图表/图谱真实数据对接 |
| WS7 业务能力落地 | 业务工具/技能/Agent | Data Fetchers、算法技能（BS-06/08）、业务 Prompt、解决方案编排 |
| WS8 可观测与性能 | 生产化能力 | 监控、日志、告警、限流、性能优化、API 文档 |

---

## 5. 任务看板（Backlog → Sprint）

### 5.1 P0 任务（阻塞闭环 / 影响正确性）

| ID | 工作流 | 任务 | 交付物 | 依赖 | 验收口径 |
|---|---|---|---|---|---|
| P0-01 | WS2 | 权限口径收敛 | 后端权限判断与过滤统一为 `public/department/role`；历史数据回填策略 | DB/接口联调 | department/role 资源对正确用户可见、对非授权用户不可见；相关列表与 chat stream 一致 |
| P0-02 | WS3 | Provider/Adapter 对齐与兜底 | 不支持的 provider 不可被选择或可清晰提示；fallback 策略明确（DB 为主、env 为辅或移除） | 前端配置页 | 选择任一可选 provider 均可正常调用；不可用 provider 有明确状态与错误信息 |
| P0-03 | WS1 | Engine 入口收敛 | `graph.py` 与 `nfc_graph.py` 职责合并/统一入口；减少维护分叉 | 回归测试 | 主对话流无回归；工具调用与 SSE 事件保持兼容 |
| P0-04 | WS7 | 核心数据获取工具补齐 | `fetch_internal_tx`、`fetch_external_saic` 可在工具体系中被调用 | 数据源接入 | 能获取样例数据并返回结构化结果；失败有可定位错误码 |

### 5.2 P1 任务（核心功能扩展 / 提升效率）

| ID | 工作流 | 任务 | 交付物 | 依赖 | 验收口径 |
|---|---|---|---|---|---|
| P1-01 | WS4 | `/tools` 真对接与在线测试 | 列表/详情/编辑/测试/血缘入口 | P0-01 | 工具管理从 UI 骨架变为可用；测试可产生 tool_call/tool_result |
| P1-02 | WS4 | `/skills` 编排落库与执行 | ReactFlow DAG → workflow 落库；执行时按映射调度 Tool | P0-03、P1-01 | 新建 Skill 可保存/发布；在对话中可被调用并得到结果 |
| P1-03 | WS7 | 算法技能补齐 | BS-06 亲密度、BS-08 TOPSIS | 数据/算法 | 给定样例输入可输出稳定可解释结果；有边界条件处理 |
| P1-04 | WS7 | 业务 Prompt 工程 | Few-shot、术语表、模板化输出约束 | 业务专家 | 在目标场景下输出更稳定；可回归验证（基于样例用例） |
| P1-05 | WS5 | 数据标准编辑闭环 | TableField/ToolDataMapping 增删改 + 校验 + 选择器 | P1-01 | 能完成“标准字段 ↔ 工具字段”映射；血缘图可渲染 |

### 5.3 P2 任务（体验与端到端完善）

| ID | 工作流 | 任务 | 交付物 | 依赖 | 验收口径 |
|---|---|---|---|---|---|
| P2-01 | WS6 | artifact 事件规范化与 Canvas 闭环 | 后端 artifact schema；前端 Canvas 支持保存/导出最小闭环 | P1-02 | 对话可产生 artifact；用户可在 Canvas 编辑并导出 |
| P2-02 | WS6 | 可视化组件真数据对接 | 关系图谱/雷达图/风险看板至少 2 个组件接真数据 | 数据工具 | 组件不再占位；有空态/异常态处理 |
| P2-03 | WS1/WS7 | Human-in-the-loop | 缺参时主动澄清；支持用户确认/修正计划 | P0-03 | 复杂任务不会“瞎跑”；可中断/继续；交互可演示 |

### 5.4 P3 任务（文档与开放）

| ID | 工作流 | 任务 | 交付物 | 验收口径 |
|---|---|---|---|---|
| P3-01 | WS8 | API/错误码文档 | API 说明、SSE 事件、错误码规范 | 前后端对齐；新同学可按文档完成对接 |
| P3-02 | WS7 | 算法说明书 | BS-01～BS-08 说明 | 输入/输出/边界/解释性齐全 |
| P3-03 | WS5 | 数据字典 | 《Nebula 数据字典 v1.0》 | 标准表/字段口径可查、可版本化 |

---

## 6. Sprint 交付计划（建议排期）

> 说明：排期以 Sprint 为单位给出“建议顺序”，具体日期按团队资源调整。

### Sprint 1（M1 目标：核心稳定）

- 交付：P0-01、P0-02（至少完成“可用/可选/可提示”闭环）、P0-03（确定统一入口方案并落地）
- 风险点：P0-01 可能涉及历史数据回填与前后端联动；必须优先做“口径统一与回归用例”

### Sprint 2（M1 收尾 + M2 启动）

- 交付：P0-04（数据工具可用）；P1-01（/tools 真对接 + 在线测试 MVP）
- 验收演示：对话中调用新工具，SSE 展示 tool_call/tool_result，页面可管理与测试

### Sprint 3（M2：知识工程 MVP）

- 交付：P1-02（/skills 编排落库与执行 MVP）；P1-05（数据标准编辑闭环第一版）
- 验收演示：通过技能编排跑通 2–3 个工具链路，并能渲染血缘图

### Sprint 4（M3/M4 启动：可解释 + 可沉淀）

- 交付：P2-01（artifact 与 Canvas MVP）；P2-02（至少 1 个可视化组件接真数据）
- 验收演示：对话产出“可编辑报告/图谱”，用户可编辑并导出

### Sprint 5+（M5：业务包 1.0）

- 交付：P1-03、P1-04（算法技能 + Prompt 稳定）；补齐 3–5 Tool、2–3 Skill、2 Agent 的可复用组合

### Sprint 6+（M6：生产化）

- 交付：缓存/共享记忆（Redis）、可观测/限流、性能优化、API 文档与验收用例固化

---

## 7. 关键依赖与风险清单

### 7.1 关键依赖

- **数据源可用性**：内部交易数据、外部工商/舆情等接口需要明确鉴权与稳定性 SLA
- **模型服务商策略**：Provider 可用性、额度、超时、错误码需纳入统一规范
- **前后端契约**：SSE 事件、组件 schema、artifact schema 必须“先定契约再实现”

### 7.2 主要风险与应对

| 风险 | 影响 | 应对 |
|---|---|---|
| 权限口径改动引发回归 | 工具/技能不可用或越权 | 用例覆盖：列表 API + chat stream + 前端可见性联动回归 |
| Provider 不一致导致不可用 | 选了模型就失败 | “可选即可用”原则；不可用必须在配置层拦截或清晰降级 |
| 编排入口分叉长期存在 | 维护成本高、问题难定位 | M1 强制收敛入口；保留兼容层但统一对外 API |
| 可视化/Canvas 只做 UI | 无法形成业务闭环 | 每个 Sprint 都要有端到端演示（含真实/半真实数据） |

---

## 8. 验收清单（Definition of Done）

- 任务有明确：输入、输出、边界条件、错误处理、日志与可观测点（最小）
- 前后端契约：字段名、枚举值、事件类型、错误码已对齐
- 有可复现的演示脚本/用例（至少 1 条 happy path + 1 条失败路径）
- 合并前通过：基础回归（相关页面/接口）与核心链路演示

